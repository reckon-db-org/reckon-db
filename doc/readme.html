<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="reckon_db v1.1.0">


    <title>Readme â€” reckon_db v1.1.0</title>

    <link rel="stylesheet" href="dist/html-erlang-DQDXQC7W.css" />

    <script defer src="dist/sidebar_items-B1D808EB.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
reckon_db
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.1.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of reckon_db</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>reckon-db</h1>


      <a href="https://github.com/reckon-db-org/reckon-db/blob/v1.1.0/README.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p><a href="https://buymeacoffee.com/beamologist"><img src="https://img.shields.io/badge/Buy%20Me%20A%20Coffee-support-yellow.svg" alt="Buy Me A Coffee"/></a></p><p>BEAM-native Event Store built on Khepri/Ra with Raft consensus.</p><p><img src="assets/architecture.svg" alt="Architecture"/></p><h2 id="overview" class="section-heading"><a href="#overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Overview</span></h2><p>reckon-db is an Erlang implementation of a distributed event store designed for:</p><ul><li><strong>Event Sourcing</strong>: Store and replay events with optimistic concurrency</li><li><strong>Clustering</strong>: Automatic node discovery and Raft-based replication</li><li><strong>High Throughput</strong>: Partitioned writers for concurrent stream writes</li><li><strong>Edge &amp; Datacenter</strong>: Works on Nerves devices and Kubernetes clusters</li></ul><h2 id="features" class="section-heading"><a href="#features" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Features</span></h2><ul><li>Event stream operations (append, read, subscribe) with versioning and optimistic concurrency</li><li>Persistent subscriptions (stream, event type, pattern, payload matching)</li><li>Snapshot management for aggregate state</li><li>Emitter pools for high-throughput event delivery</li><li>UDP multicast and Kubernetes DNS discovery</li><li>BEAM telemetry with optional OpenTelemetry exporters</li></ul><h2 id="installation" class="section-heading"><a href="#installation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Installation</span></h2><p>Add to your <code class="inline">rebar.config</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="5471613431-1">{</span><span class="ss">deps</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5471613431-2">[</span><span class="w">
    </span><span class="p" data-group-id="5471613431-3">{</span><span class="ss">reckon_db</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p" data-group-id="5471613431-3">}</span><span class="w">
</span><span class="p" data-group-id="5471613431-2">]</span><span class="p" data-group-id="5471613431-1">}</span><span class="p">.</span></code></pre><p>Pure Erlang implementation - works everywhere, no native dependencies.</p><h2 id="quick-start" class="section-heading"><a href="#quick-start" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Quick Start</span></h2><pre><code class="makeup erlang" translate="no"><span class="c1">%% Start the application</span><span class="w">
</span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="7178448090-1">(</span><span class="ss">reckon_db</span><span class="p" data-group-id="7178448090-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Append events to a stream</span><span class="w">
</span><span class="n">Events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7178448090-2">[</span><span class="w">
    </span><span class="p" data-group-id="7178448090-3">#{</span><span class="w">
        </span><span class="ss">event_type</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-4">&lt;&lt;</span><span class="s">&quot;user_created&quot;</span><span class="p" data-group-id="7178448090-4">&gt;&gt;</span><span class="p">,</span><span class="w">
        </span><span class="ss">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-5">#{</span><span class="ss">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-6">&lt;&lt;</span><span class="s">&quot;Alice&quot;</span><span class="p" data-group-id="7178448090-6">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-7">&lt;&lt;</span><span class="s">&quot;alice@example.com&quot;</span><span class="p" data-group-id="7178448090-7">&gt;&gt;</span><span class="p" data-group-id="7178448090-5">}</span><span class="p">,</span><span class="w">
        </span><span class="ss">metadata</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-8">#{</span><span class="ss">correlation_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7178448090-9">&lt;&lt;</span><span class="s">&quot;req-123&quot;</span><span class="p" data-group-id="7178448090-9">&gt;&gt;</span><span class="p" data-group-id="7178448090-8">}</span><span class="w">
    </span><span class="p" data-group-id="7178448090-3">}</span><span class="w">
</span><span class="p" data-group-id="7178448090-2">]</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="7178448090-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="7178448090-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">append</span><span class="p" data-group-id="7178448090-11">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7178448090-12">&lt;&lt;</span><span class="s">&quot;user-123&quot;</span><span class="p" data-group-id="7178448090-12">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Events</span><span class="p" data-group-id="7178448090-11">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Read events from a stream</span><span class="w">
</span><span class="p" data-group-id="7178448090-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ReadEvents</span><span class="p" data-group-id="7178448090-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="7178448090-14">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7178448090-15">&lt;&lt;</span><span class="s">&quot;user-123&quot;</span><span class="p" data-group-id="7178448090-15">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="ss">forward</span><span class="p" data-group-id="7178448090-14">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Subscribe to events</span><span class="w">
</span><span class="p" data-group-id="7178448090-16">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">SubKey</span><span class="p" data-group-id="7178448090-16">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">subscribe</span><span class="p" data-group-id="7178448090-17">(</span><span class="w">
    </span><span class="ss">my_store</span><span class="p">,</span><span class="w">
    </span><span class="ss">stream</span><span class="p">,</span><span class="w">                    </span><span class="c1">%% Type: stream | event_type | event_pattern | event_payload</span><span class="w">
    </span><span class="p" data-group-id="7178448090-18">&lt;&lt;</span><span class="s">&quot;user-123&quot;</span><span class="p" data-group-id="7178448090-18">&gt;&gt;</span><span class="p">,</span><span class="w">            </span><span class="c1">%% Selector</span><span class="w">
    </span><span class="p" data-group-id="7178448090-19">&lt;&lt;</span><span class="s">&quot;user_projection&quot;</span><span class="p" data-group-id="7178448090-19">&gt;&gt;</span><span class="w">      </span><span class="c1">%% Subscription name</span><span class="w">
</span><span class="p" data-group-id="7178448090-17">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Receive events</span><span class="w">
</span><span class="k">receive</span><span class="w">
    </span><span class="p" data-group-id="7178448090-20">{</span><span class="ss">event</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p" data-group-id="7178448090-20">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7178448090-21">(</span><span class="s">&quot;Received: </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7178448090-22">[</span><span class="n">Event</span><span class="p" data-group-id="7178448090-22">]</span><span class="p" data-group-id="7178448090-21">)</span><span class="w">
</span><span class="k">end</span><span class="p">.</span></code></pre><h2 id="api-reference" class="section-heading"><a href="#api-reference" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">API Reference</span></h2><h3 id="streams" class="section-heading"><a href="#streams" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Streams</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Append events (returns new version)</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">append</span><span class="p" data-group-id="7993737745-1">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">ExpectedVersion</span><span class="p">,</span><span class="w"> </span><span class="n">Events</span><span class="p" data-group-id="7993737745-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7993737745-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">NewVersion</span><span class="p" data-group-id="7993737745-2">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-3">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">version_mismatch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-4">(</span><span class="p" data-group-id="7993737745-4">)</span><span class="p" data-group-id="7993737745-3">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Read events from a stream</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="7993737745-5">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">FromVersion</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p" data-group-id="7993737745-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7993737745-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7993737745-7">[</span><span class="n">Event</span><span class="p" data-group-id="7993737745-7">]</span><span class="p" data-group-id="7993737745-6">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-8">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">stream_not_found</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-9">(</span><span class="p" data-group-id="7993737745-9">)</span><span class="p" data-group-id="7993737745-8">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Read across all streams</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read_all</span><span class="p" data-group-id="7993737745-10">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">FromVersion</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p" data-group-id="7993737745-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7993737745-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7993737745-12">[</span><span class="n">Event</span><span class="p" data-group-id="7993737745-12">]</span><span class="p" data-group-id="7993737745-11">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-13">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-14">(</span><span class="p" data-group-id="7993737745-14">)</span><span class="p" data-group-id="7993737745-13">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Read events by type</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read_by_event_types</span><span class="p" data-group-id="7993737745-15">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">EventTypes</span><span class="p">,</span><span class="w"> </span><span class="n">Opts</span><span class="p" data-group-id="7993737745-15">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7993737745-16">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7993737745-17">[</span><span class="n">Event</span><span class="p" data-group-id="7993737745-17">]</span><span class="p" data-group-id="7993737745-16">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-18">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-19">(</span><span class="p" data-group-id="7993737745-19">)</span><span class="p" data-group-id="7993737745-18">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Get stream version</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">get_version</span><span class="p" data-group-id="7993737745-20">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="7993737745-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7993737745-21">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="7993737745-21">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-22">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-23">(</span><span class="p" data-group-id="7993737745-23">)</span><span class="p" data-group-id="7993737745-22">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Check if stream exists</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">exists</span><span class="p" data-group-id="7993737745-24">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="7993737745-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">boolean</span><span class="p" data-group-id="7993737745-25">(</span><span class="p" data-group-id="7993737745-25">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% List all streams</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">list_streams</span><span class="p" data-group-id="7993737745-26">(</span><span class="n">StoreId</span><span class="p" data-group-id="7993737745-26">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7993737745-27">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7993737745-28">[</span><span class="n">StreamId</span><span class="p" data-group-id="7993737745-28">]</span><span class="p" data-group-id="7993737745-27">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-29">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-30">(</span><span class="p" data-group-id="7993737745-30">)</span><span class="p" data-group-id="7993737745-29">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Delete stream (soft delete)</span><span class="w">
</span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7993737745-31">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="7993737745-31">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="7993737745-32">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="7993737745-33">(</span><span class="p" data-group-id="7993737745-33">)</span><span class="p" data-group-id="7993737745-32">}</span><span class="p">.</span></code></pre><h3 id="subscriptions" class="section-heading"><a href="#subscriptions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Subscriptions</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Create subscription</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">subscribe</span><span class="p" data-group-id="6883689018-1">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">Selector</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="6883689018-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6883689018-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionKey</span><span class="p" data-group-id="6883689018-2">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6883689018-3">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="6883689018-4">(</span><span class="p" data-group-id="6883689018-4">)</span><span class="p" data-group-id="6883689018-3">}</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">subscribe</span><span class="p" data-group-id="6883689018-5">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">Selector</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Opts</span><span class="p" data-group-id="6883689018-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6883689018-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionKey</span><span class="p" data-group-id="6883689018-6">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6883689018-7">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="6883689018-8">(</span><span class="p" data-group-id="6883689018-8">)</span><span class="p" data-group-id="6883689018-7">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Remove subscription (by key or by type+name)</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">unsubscribe</span><span class="p" data-group-id="6883689018-9">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionKey</span><span class="p" data-group-id="6883689018-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6883689018-10">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="6883689018-11">(</span><span class="p" data-group-id="6883689018-11">)</span><span class="p" data-group-id="6883689018-10">}</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">unsubscribe</span><span class="p" data-group-id="6883689018-12">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionName</span><span class="p" data-group-id="6883689018-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6883689018-13">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="nf">term</span><span class="p" data-group-id="6883689018-14">(</span><span class="p" data-group-id="6883689018-14">)</span><span class="p" data-group-id="6883689018-13">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Get subscription by key</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="6883689018-15">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionKey</span><span class="p" data-group-id="6883689018-15">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6883689018-16">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Subscription</span><span class="p" data-group-id="6883689018-16">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="6883689018-17">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">not_found</span><span class="p" data-group-id="6883689018-17">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Acknowledge event processing</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">ack</span><span class="p" data-group-id="6883689018-18">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionName</span><span class="p">,</span><span class="w"> </span><span class="n">EventNumber</span><span class="p" data-group-id="6883689018-18">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% List subscriptions</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">list</span><span class="p" data-group-id="6883689018-19">(</span><span class="n">StoreId</span><span class="p" data-group-id="6883689018-19">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="6883689018-20">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6883689018-21">[</span><span class="n">Subscription</span><span class="p" data-group-id="6883689018-21">]</span><span class="p" data-group-id="6883689018-20">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Check if subscription exists</span><span class="w">
</span><span class="nc">reckon_db_subscriptions</span><span class="p">:</span><span class="nf">exists</span><span class="p" data-group-id="6883689018-22">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">SubscriptionKey</span><span class="p" data-group-id="6883689018-22">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">boolean</span><span class="p" data-group-id="6883689018-23">(</span><span class="p" data-group-id="6883689018-23">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Subscription types:</span><span class="w">
</span><span class="c1">%%   stream - Events from a specific stream</span><span class="w">
</span><span class="c1">%%   event_type - Events matching event type</span><span class="w">
</span><span class="c1">%%   event_pattern - Events matching stream pattern (wildcards)</span><span class="w">
</span><span class="c1">%%   event_payload - Events matching payload criteria</span></code></pre><h3 id="snapshots" class="section-heading"><a href="#snapshots" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Snapshots</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Save snapshot</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">save</span><span class="p" data-group-id="4781227963-1">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4781227963-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">save</span><span class="p" data-group-id="4781227963-2">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="p" data-group-id="4781227963-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Load latest snapshot</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="4781227963-3">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="4781227963-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4781227963-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="p" data-group-id="4781227963-4">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="4781227963-5">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">not_found</span><span class="p" data-group-id="4781227963-5">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Load snapshot at specific version</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">load_at</span><span class="p" data-group-id="4781227963-6">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="4781227963-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4781227963-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="p" data-group-id="4781227963-7">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p" data-group-id="4781227963-8">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="ss">not_found</span><span class="p" data-group-id="4781227963-8">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% List all snapshots for stream</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">list</span><span class="p" data-group-id="4781227963-9">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="4781227963-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4781227963-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4781227963-11">[</span><span class="n">Snapshot</span><span class="p" data-group-id="4781227963-11">]</span><span class="p" data-group-id="4781227963-10">}</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Delete all snapshots for stream</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4781227963-12">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="4781227963-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Delete snapshot at specific version</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">delete_at</span><span class="p" data-group-id="4781227963-13">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="4781227963-13">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Check if snapshot exists</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">exists</span><span class="p" data-group-id="4781227963-14">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="4781227963-14">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">boolean</span><span class="p" data-group-id="4781227963-15">(</span><span class="p" data-group-id="4781227963-15">)</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">exists_at</span><span class="p" data-group-id="4781227963-16">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="4781227963-16">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">boolean</span><span class="p" data-group-id="4781227963-17">(</span><span class="p" data-group-id="4781227963-17">)</span><span class="p">.</span></code></pre><h3 id="aggregation" class="section-heading"><a href="#aggregation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Aggregation</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Fold events left to right (chronological order)</span><span class="w">
</span><span class="c1">%% Returns a tagged_map with {sum, N} and {overwrite, V} tags preserved</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">foldl</span><span class="p" data-group-id="3010240914-1">(</span><span class="n">Events</span><span class="p" data-group-id="3010240914-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">tagged_map</span><span class="p" data-group-id="3010240914-2">(</span><span class="p" data-group-id="3010240914-2">)</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">foldl</span><span class="p" data-group-id="3010240914-3">(</span><span class="n">Events</span><span class="p">,</span><span class="w"> </span><span class="n">InitialState</span><span class="p" data-group-id="3010240914-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">tagged_map</span><span class="p" data-group-id="3010240914-4">(</span><span class="p" data-group-id="3010240914-4">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Fold events right to left (reverse order)</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">foldr</span><span class="p" data-group-id="3010240914-5">(</span><span class="n">Events</span><span class="p" data-group-id="3010240914-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">tagged_map</span><span class="p" data-group-id="3010240914-6">(</span><span class="p" data-group-id="3010240914-6">)</span><span class="p">.</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">foldr</span><span class="p" data-group-id="3010240914-7">(</span><span class="n">Events</span><span class="p">,</span><span class="w"> </span><span class="n">InitialState</span><span class="p" data-group-id="3010240914-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">tagged_map</span><span class="p" data-group-id="3010240914-8">(</span><span class="p" data-group-id="3010240914-8">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Finalize a tagged map (unwrap {sum, N} -&gt; N, {overwrite, V} -&gt; V)</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">finalize</span><span class="p" data-group-id="3010240914-9">(</span><span class="n">TaggedMap</span><span class="p" data-group-id="3010240914-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3010240914-10">(</span><span class="p" data-group-id="3010240914-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Aggregate events with optional snapshot (convenience function)</span><span class="w">
</span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">aggregate</span><span class="p" data-group-id="3010240914-11">(</span><span class="n">Events</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="ss">undefined</span><span class="p">,</span><span class="w"> </span><span class="n">Opts</span><span class="p" data-group-id="3010240914-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3010240914-12">(</span><span class="p" data-group-id="3010240914-12">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%% Opts: #{initial_state =&gt; map(), finalize =&gt; boolean()}</span></code></pre><p>Example usage:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Load events and aggregate</span><span class="w">
</span><span class="p" data-group-id="5843921414-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Events</span><span class="p" data-group-id="5843921414-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="5843921414-2">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5843921414-3">&lt;&lt;</span><span class="s">&quot;account-123&quot;</span><span class="p" data-group-id="5843921414-3">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="ss">forward</span><span class="p" data-group-id="5843921414-2">)</span><span class="p">,</span><span class="w">
</span><span class="n">TaggedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">foldl</span><span class="p" data-group-id="5843921414-4">(</span><span class="n">Events</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5843921414-5">#{</span><span class="ss">balance</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="5843921414-6">{</span><span class="ss">sum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5843921414-6">}</span><span class="p" data-group-id="5843921414-5">}</span><span class="p" data-group-id="5843921414-4">)</span><span class="p">,</span><span class="w">
</span><span class="n">FinalState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">finalize</span><span class="p" data-group-id="5843921414-7">(</span><span class="n">TaggedState</span><span class="p" data-group-id="5843921414-7">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Or use aggregate/3 with snapshot support</span><span class="w">
</span><span class="p" data-group-id="5843921414-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="p" data-group-id="5843921414-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_snapshots</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="5843921414-9">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5843921414-10">&lt;&lt;</span><span class="s">&quot;account-123&quot;</span><span class="p" data-group-id="5843921414-10">&gt;&gt;</span><span class="p" data-group-id="5843921414-9">)</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="5843921414-11">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">NewEvents</span><span class="p" data-group-id="5843921414-11">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_streams</span><span class="p">:</span><span class="nf">read</span><span class="p" data-group-id="5843921414-12">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5843921414-13">&lt;&lt;</span><span class="s">&quot;account-123&quot;</span><span class="p" data-group-id="5843921414-13">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="o">#</span><span class="ss">snapshot</span><span class="p">.</span><span class="ss">version</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="ss">forward</span><span class="p" data-group-id="5843921414-12">)</span><span class="p">,</span><span class="w">
</span><span class="n">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">reckon_db_aggregator</span><span class="p">:</span><span class="nf">aggregate</span><span class="p" data-group-id="5843921414-14">(</span><span class="n">NewEvents</span><span class="p">,</span><span class="w"> </span><span class="n">Snapshot</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5843921414-15">#{</span><span class="p" data-group-id="5843921414-15">}</span><span class="p" data-group-id="5843921414-14">)</span><span class="p">.</span></code></pre><h3 id="telemetry" class="section-heading"><a href="#telemetry" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Telemetry</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% Attach default logger handler</span><span class="w">
</span><span class="nc">reckon_db_telemetry</span><span class="p">:</span><span class="nf">attach_default_handler</span><span class="p" data-group-id="6199486382-1">(</span><span class="p" data-group-id="6199486382-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Attach custom handler</span><span class="w">
</span><span class="nc">reckon_db_telemetry</span><span class="p">:</span><span class="nf">attach</span><span class="p" data-group-id="6199486382-2">(</span><span class="n">HandlerId</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerFun</span><span class="p">,</span><span class="w"> </span><span class="n">Config</span><span class="p" data-group-id="6199486382-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Detach handler</span><span class="w">
</span><span class="nc">reckon_db_telemetry</span><span class="p">:</span><span class="nf">detach</span><span class="p" data-group-id="6199486382-3">(</span><span class="n">HandlerId</span><span class="p" data-group-id="6199486382-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">ok</span><span class="p">.</span></code></pre><h2 id="configuration" class="section-heading"><a href="#configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuration</span></h2><pre><code class="makeup erlang" translate="no"><span class="c1">%% sys.config</span><span class="w">
</span><span class="p" data-group-id="4469005038-1">[</span><span class="p" data-group-id="4469005038-2">{</span><span class="ss">reckon_db</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-3">[</span><span class="w">
    </span><span class="p" data-group-id="4469005038-4">{</span><span class="ss">stores</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-5">[</span><span class="w">
        </span><span class="p" data-group-id="4469005038-6">{</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-7">[</span><span class="w">
            </span><span class="p" data-group-id="4469005038-8">{</span><span class="ss">data_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/var/lib/reckon_db/my_store&quot;</span><span class="p" data-group-id="4469005038-8">}</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4469005038-9">{</span><span class="ss">mode</span><span class="p">,</span><span class="w"> </span><span class="ss">cluster</span><span class="p" data-group-id="4469005038-9">}</span><span class="p">,</span><span class="w">  </span><span class="c1">%% single | cluster</span><span class="w">
            </span><span class="p" data-group-id="4469005038-10">{</span><span class="ss">timeout</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p" data-group-id="4469005038-10">}</span><span class="w">
        </span><span class="p" data-group-id="4469005038-7">]</span><span class="p" data-group-id="4469005038-6">}</span><span class="w">
    </span><span class="p" data-group-id="4469005038-5">]</span><span class="p" data-group-id="4469005038-4">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4469005038-11">{</span><span class="ss">telemetry_handlers</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-12">[</span><span class="ss">logger</span><span class="p" data-group-id="4469005038-12">]</span><span class="p" data-group-id="4469005038-11">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4469005038-13">{</span><span class="ss">writer_pool_size</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="4469005038-13">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4469005038-14">{</span><span class="ss">reader_pool_size</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="4469005038-14">}</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Cluster discovery (cluster mode only)</span><span class="w">
    </span><span class="p" data-group-id="4469005038-15">{</span><span class="ss">discovery</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-16">[</span><span class="w">
        </span><span class="p" data-group-id="4469005038-17">{</span><span class="ss">method</span><span class="p">,</span><span class="w"> </span><span class="ss">multicast</span><span class="p" data-group-id="4469005038-17">}</span><span class="p">,</span><span class="w">  </span><span class="c1">%% multicast | k8s_dns</span><span class="w">
        </span><span class="p" data-group-id="4469005038-18">{</span><span class="ss">port</span><span class="p">,</span><span class="w"> </span><span class="mi">45892</span><span class="p" data-group-id="4469005038-18">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="4469005038-19">{</span><span class="ss">multicast_addr</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-20">{</span><span class="mi">239</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4469005038-20">}</span><span class="p" data-group-id="4469005038-19">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="4469005038-21">{</span><span class="ss">secret</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4469005038-22">&lt;&lt;</span><span class="s">&quot;cluster_secret&quot;</span><span class="p" data-group-id="4469005038-22">&gt;&gt;</span><span class="p" data-group-id="4469005038-21">}</span><span class="w">
    </span><span class="p" data-group-id="4469005038-16">]</span><span class="p" data-group-id="4469005038-15">}</span><span class="w">
</span><span class="p" data-group-id="4469005038-3">]</span><span class="p" data-group-id="4469005038-2">}</span><span class="p" data-group-id="4469005038-1">]</span><span class="p">.</span></code></pre><h2 id="architecture" class="section-heading"><a href="#architecture" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Architecture</span></h2><h3 id="supervision-tree" class="section-heading"><a href="#supervision-tree" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Supervision Tree</span></h3><p><img src="assets/supervision_tree.svg" alt="Supervision Tree"/></p><h3 id="event-flow" class="section-heading"><a href="#event-flow" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Event Flow</span></h3><p><img src="assets/event_flow.svg" alt="Event Flow"/></p><h2 id="telemetry-events" class="section-heading"><a href="#telemetry-events" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Telemetry Events</span></h2><table><thead><tr><th style="text-align: left;">Event</th><th style="text-align: left;">Measurements</th><th style="text-align: left;">Metadata</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">[reckon_db, stream, write, start]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, stream_id, event_count</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, stream, write, stop]</code></td><td style="text-align: left;">duration, event_count</td><td style="text-align: left;">store_id, stream_id, new_version</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, stream, write, error]</code></td><td style="text-align: left;">duration</td><td style="text-align: left;">store_id, stream_id, reason</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, stream, read, start]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, stream_id</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, stream, read, stop]</code></td><td style="text-align: left;">duration, event_count</td><td style="text-align: left;">store_id, stream_id</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, subscription, created]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, subscription_id, type</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, subscription, deleted]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, subscription_id</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, snapshot, created]</code></td><td style="text-align: left;">duration, size_bytes</td><td style="text-align: left;">store_id, stream_id, version</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, cluster, node, up]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, node, member_count</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, cluster, node, down]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, node, reason</td></tr><tr><td style="text-align: left;"><code class="inline">[reckon_db, cluster, leader, elected]</code></td><td style="text-align: left;">system_time</td><td style="text-align: left;">store_id, leader</td></tr></tbody></table><h2 id="building" class="section-heading"><a href="#building" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Building</span></h2><pre><code class="makeup bash" translate="no"><span class="">rebar3 compile         # Compile
</span><span class="">rebar3 eunit           # Unit tests
</span><span class="">rebar3 ct              # Integration tests
</span><span class="">rebar3 dialyzer        # Type checking
</span><span class="">rebar3 cover           # Coverage report
</span></code></pre><h2 id="testing" class="section-heading"><a href="#testing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Testing</span></h2><p>Test counts:</p><ul><li><strong>Unit tests</strong>: 446 tests (including NIF modules with enterprise/community equivalence tests)</li><li><strong>Integration tests</strong>: 53 tests (streams, subscriptions, snapshots, cluster)</li><li><strong>End-to-end tests</strong>: 24 tests (full gater integration)</li></ul><pre><code class="makeup bash" translate="no"><span class="">rebar3 eunit --dir=test/unit              # All unit tests
</span><span class="">rebar3 ct --dir=test/integration          # Integration tests
</span><span class="">rebar3 ct --dir=test/e2e                  # E2E tests with gater
</span><span class="">rebar3 ct --suite=reckon_db_streams_SUITE  # Streams tests
</span><span class="">rebar3 ct --suite=reckon_db_cluster_SUITE  # Cluster tests
</span></code></pre><h2 id="gateway-api" class="section-heading"><a href="#gateway-api" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Gateway API</span></h2><p>reckon-db is accessed through <a href="https://github.com/reckon-db-org/reckon-gater">reckon-gater</a>, which provides the unified API for load-balanced, distributed access to event stores.</p><h3 id="how-it-works" class="section-heading"><a href="#how-it-works" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">How It Works</span></h3><ol><li><strong>reckon-db</strong> starts and creates a gateway worker for each store</li><li>Gateway workers register with the <strong>reckon-gater</strong> pg-based registry</li><li>Clients use the gater API for all event store operations</li><li>The gater routes requests to registered workers using round-robin with failover</li></ol><h3 id="architecture-1" class="section-heading"><a href="#architecture-1" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Architecture</span></h3><p><img src="assets/gateway_architecture.svg" alt="Gateway Architecture"/></p><h3 id="using-the-gateway-api" class="section-heading"><a href="#using-the-gateway-api" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Using the Gateway API</span></h3><p>All event store operations go through the gater API:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Stream operations</span><span class="w">
</span><span class="p" data-group-id="9354134732-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="9354134732-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">append_events</span><span class="p" data-group-id="9354134732-2">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Events</span><span class="p" data-group-id="9354134732-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9354134732-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Events</span><span class="p" data-group-id="9354134732-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">stream_forward</span><span class="p" data-group-id="9354134732-4">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="9354134732-4">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9354134732-5">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="9354134732-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">get_version</span><span class="p" data-group-id="9354134732-6">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p" data-group-id="9354134732-6">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Subscription operations</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">save_subscription</span><span class="p" data-group-id="9354134732-7">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="ss">stream</span><span class="p">,</span><span class="w"> </span><span class="n">StreamId</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9354134732-8">(</span><span class="p" data-group-id="9354134732-8">)</span><span class="p" data-group-id="9354134732-7">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Snapshot operations</span><span class="w">
</span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">record_snapshot</span><span class="p" data-group-id="9354134732-9">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="n">SourceUuid</span><span class="p">,</span><span class="w"> </span><span class="n">StreamUuid</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p">,</span><span class="w"> </span><span class="n">Record</span><span class="p" data-group-id="9354134732-9">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9354134732-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Snap</span><span class="p" data-group-id="9354134732-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">esdb_gater_api</span><span class="p">:</span><span class="nf">read_snapshot</span><span class="p" data-group-id="9354134732-11">(</span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="n">SourceUuid</span><span class="p">,</span><span class="w"> </span><span class="n">StreamUuid</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p" data-group-id="9354134732-11">)</span><span class="p">.</span></code></pre><p>See <a href="https://hex.pm/packages/reckon_gater">reckon-gater</a> for complete API documentation.</p><h2 id="related-projects" class="section-heading"><a href="#related-projects" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Related Projects</span></h2><ul><li><a href="https://github.com/reckon-db-org/reckon-gater">reckon-gater</a> - Gateway for distributed access</li><li><a href="https://github.com/beam-campus/ex-esdb">ex-esdb</a> - Original Elixir implementation</li></ul><h2 id="license" class="section-heading"><a href="#license" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">License</span></h2><p>Apache-2.0</p>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

  </div>
  <div class="bottom-actions-item">

      <a href="license.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
License
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/reckon_db/1.1.0" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/reckon_db/1.1.0">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/reckon_db/1.1.0/show/README.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="reckon_db.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
